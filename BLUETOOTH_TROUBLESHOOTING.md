# 블루투스 수신 문제 해결 가이드

## 🔍 문제 진단 단계

### 1단계: Logcat 확인

앱을 실행하고 Android Studio의 Logcat에서 다음 로그를 확인하세요:

#### ✅ 정상 연결 시 나타나는 로그:
```
페어링된 장치 개수: X
페어링된 장치: 이름=HC-06, 주소=XX:XX:XX:XX:XX:XX
타겟 장치 발견: HC-06
장치 연결 시도: HC-06 (XX:XX:XX:XX:XX:XX)
블루투스 소켓 연결 성공
BluetoothSocket 연결 상태 확인: 연결됨
InputStream 생성 성공, BufferedReader 생성 중...
블루투스 InputStream 및 BufferedReader 생성 성공
블루투스 데이터 수신 스레드 시작됨
블루투스 데이터 수신 스레드 시작 (소켓 연결됨: true)
블루투스 데이터 수신 중... (총 X개, X.X초 경과, X.X개/초, 현재 값: XXX)
```

#### ❌ 문제 발생 시 나타나는 로그:

**문제 1: 장치를 찾을 수 없음**
```
타겟 장치를 찾을 수 없음: HC-06
```
**해결**: 
- Android 블루투스 설정에서 페어링된 장치 이름 확인
- Logcat에서 "페어링된 장치: 이름=..." 로그 확인
- `TARGET_DEVICE_NAME` 상수를 실제 장치 이름으로 변경

**문제 2: 연결 실패**
```
소켓 연결 실패: ...
```
**해결**:
- Arduino가 켜져 있는지 확인
- HC-06 모듈의 LED 상태 확인 (연결 시 깜빡임)
- 다른 앱에서 블루투스 사용 중인지 확인

**문제 3: 스트림 생성 실패**
```
Input Stream 생성 실패
```
**해결**:
- 블루투스 권한 확인
- 앱 재시작

**문제 4: 데이터 수신 없음**
```
블루투스 연결됨, 하지만 데이터 수신 없음
```
**해결**:
- Arduino 코드가 업로드되었는지 확인
- Arduino 시리얼 모니터에서 데이터 출력 확인
- HC-06 모듈의 TX/RX 핀 연결 확인

---

## 🔧 일반적인 해결 방법

### 방법 1: 장치 이름 확인 및 수정

1. **Android 블루투스 설정 확인**
   - 설정 → 블루투스 → 페어링된 장치 목록 확인
   - HC-06 모듈의 실제 이름 확인 (예: "HC-06", "HC06", "HC-06-1234" 등)

2. **코드에서 장치 이름 수정**
   ```java
   // MainActivity.java 66번째 줄
   private static final String TARGET_DEVICE_NAME = "실제_장치_이름";
   ```

### 방법 2: Arduino 확인

1. **Arduino 시리얼 모니터 확인**
   - Arduino IDE에서 시리얼 모니터 열기 (9600 baud)
   - 데이터가 출력되는지 확인
   - 출력 형식: 숫자만 (줄바꿈 포함)

2. **Arduino 코드 확인**
   ```cpp
   // main.ino 확인 사항:
   - SAMPLE_DELAY = 2 (2ms = 500Hz)
   - bluetooth.begin(9600)
   - bluetooth.println(ecgValue)  // println 사용 (줄바꿈 포함)
   ```

3. **하드웨어 연결 확인**
   - HC-06 TX → Arduino 10번 핀 (RX)
   - HC-06 RX → Arduino 11번 핀 (TX)
   - HC-06 VCC → 5V
   - HC-06 GND → GND

### 방법 3: 블루투스 권한 확인

1. **Android 설정 확인**
   - 설정 → 앱 → ECG App → 권한
   - 블루투스 관련 권한 모두 허용

2. **앱 재시작**
   - 앱 완전 종료 후 재시작
   - 권한 요청 시 허용

### 방법 4: 연결 재시도

1. **블루투스 연결 해제 후 재연결**
   - Android 블루투스 설정에서 HC-06 연결 해제
   - 다시 페어링
   - 앱에서 재연결 시도

2. **Arduino 재부팅**
   - Arduino 전원 재연결
   - HC-06 모듈 재부팅

---

## 📊 Logcat 필터링 방법

Android Studio Logcat에서 다음 필터를 사용하세요:

```
tag:ECG_APP_CLASSIC
```

또는:

```
ECG_APP_CLASSIC
```

---

## 🧪 테스트 절차

### 1. 기본 연결 테스트
1. Arduino 시리얼 모니터 열기
2. Android 앱 실행
3. 블루투스 스캔 버튼 클릭
4. Logcat에서 연결 로그 확인

### 2. 데이터 수신 테스트
1. 연결 성공 후 5초 대기
2. Logcat에서 "블루투스 데이터 수신 중..." 로그 확인
3. 앱 화면에서 ECG 값이 표시되는지 확인
4. 그래프에 데이터가 표시되는지 확인

### 3. 문제 발생 시
1. Logcat의 에러 로그 확인
2. 위의 "문제 발생 시 나타나는 로그" 섹션 참고
3. 해당 문제의 해결 방법 적용

---

## 💡 추가 디버깅 팁

### Arduino 시리얼 모니터 확인
Arduino IDE에서 시리얼 모니터를 열고 다음을 확인:
- 데이터가 출력되는가?
- 출력 형식이 숫자만인가? (줄바꿈 포함)
- 출력 주기가 일정한가? (약 2ms마다)

### Android Logcat 상세 로그
다음 로그들이 나타나는지 확인:
- "페어링된 장치 개수: X" → 페어링된 장치가 있는지
- "타겟 장치 발견" → HC-06을 찾았는지
- "블루투스 소켓 연결 성공" → 연결이 성공했는지
- "블루투스 데이터 수신 중..." → 데이터가 오는지

### 데이터 포맷 확인
Arduino에서 보내는 데이터 형식:
```
512
513
514
...
```
각 숫자 뒤에 줄바꿈(`\n`)이 있어야 합니다.

---

## 🚨 자주 발생하는 문제

### 문제: "타겟 장치를 찾을 수 없음"
**원인**: 장치 이름이 "HC-06"이 아님
**해결**: Logcat에서 실제 장치 이름 확인 후 코드 수정

### 문제: "블루투스 연결됨, 하지만 데이터 수신 없음"
**원인**: 
- Arduino에서 데이터를 보내지 않음
- HC-06 모듈의 TX/RX 핀 연결 문제
- Arduino 코드가 업로드되지 않음
**해결**: 
- Arduino 시리얼 모니터 확인
- 하드웨어 연결 확인
- Arduino 코드 재업로드

### 문제: "수신된 데이터가 숫자가 아님"
**원인**: Arduino에서 숫자가 아닌 데이터 전송
**해결**: Arduino 코드 확인, `bluetooth.println(ecgValue)` 사용 확인

---

## 📞 추가 도움이 필요한 경우

문제가 해결되지 않으면 다음 정보를 제공해주세요:
1. Logcat의 전체 로그 (에러 포함)
2. Arduino 시리얼 모니터 스크린샷
3. Android 블루투스 설정의 페어링된 장치 목록
4. HC-06 모듈의 실제 이름

