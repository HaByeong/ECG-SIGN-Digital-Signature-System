# 🫀 ECG-SIGN 디지털 서명 시스템 - 최종 프로젝트 보고서

---

## 1️⃣ Target (목표): 어떤 종류의 시스템을 설계했는가?

### 1.1 프로젝트 개요
**ECG(심전도) 파형의 형태학적 특징을 기반으로 개인을 식별하는 2차 인증 디지털 서명 시스템**

본 프로젝트는 심전도(ECG, Electrocardiogram) 신호의 고유한 파형 특성을 이용하여 개인을 식별하고 인증하는 생체 인증 시스템을 개발하였다. 기존의 비밀번호, 지문, 얼굴 인식 등의 인증 방식의 보안 취약점을 보완하기 위해, "살아있는 사람만" 인증 가능한 ECG 기반 2차 인증 시스템을 설계하고 구현하였다.

### 1.2 시스템 구성도
```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              전체 시스템 아키텍처                              │
└─────────────────────────────────────────────────────────────────────────────┘

  [피부 전극]        [하드웨어 모듈]           [모바일]              [서버]
      │                    │                    │                    │
      ▼                    ▼                    ▼                    ▼
  ┌───────┐        ┌──────────────┐      ┌──────────────┐      ┌──────────────┐
  │ 심장  │───────▶│ AD8232 센서  │─────▶│ Android 앱   │─────▶│ Python 서버  │
  │ 전기  │        │ + Arduino    │  BT  │              │  TCP │              │
  │ 신호  │        │ + HC-06      │      │ 실시간 그래프 │      │ ECG 파이프라인│
  │       │        │ + LCD        │      │ 등록/로그인  │      │ 인증 관리    │
  └───────┘        └──────────────┘      └──────────────┘      └──────────────┘
                         │                      │                     │
                    500Hz 샘플링           Bluetooth SPP           TCP/IP
                    정수 문자열            + TCP Socket          JSON 응답
```

### 1.3 핵심 기능 상세

| 기능 | 설명 | 사용 기술 | 상세 내용 |
|------|------|----------|----------|
| **ECG 수집** | AD8232 센서로 심전도 측정 | Arduino, ADC | 10비트 해상도 (0-1023), 500Hz 샘플링 |
| **무선 전송** | 블루투스로 스마트폰에 전송 | HC-06, SPP | 9600bps, 줄바꿈 구분 문자열 |
| **실시간 표시** | LCD에 ECG 값 표시 | I2C LCD | 현재값 + Min/Max 범위 |
| **R-peak 검출** | 심박 위치 자동 검출 | Pan-Tompkins | 5단계 필터링, 적응형 임계값 |
| **특징 추출** | 37개+ 특징 벡터 생성 | NumPy, SciPy | 형태학적/시간/주파수/통계 |
| **서명 생성** | 해시 기반 디지털 서명 | SHA-256 | 64자 16진수 해시 |
| **인증** | 유사도 기반 본인 확인 | Hybrid Similarity | 85% 임계값 |

### 1.4 기술 스택 상세

#### 하드웨어 구성
| 구성 요소 | 모델/사양 | 역할 | 비용 |
|-----------|----------|------|------|
| **MCU** | Arduino UNO (ATmega328P) | ADC 변환, 데이터 전송 | ~15,000원 |
| **ECG 센서** | AD8232 | 심장 전기 신호 증폭, 필터링 | ~8,000원 |
| **Bluetooth** | HC-06 | 무선 시리얼 통신 (SPP) | ~5,000원 |
| **LCD** | 16x2 I2C LCD | 실시간 ECG 값 표시 | ~3,000원 |
| **전극** | 3-리드 Ag/AgCl | RA, LA, RL 배치 | ~2,000원 |

#### 소프트웨어 구성
| 플랫폼 | 언어 | 주요 라이브러리 | 역할 |
|--------|-----|-----------------|------|
| **Arduino** | C++ | SoftwareSerial, Wire, LiquidCrystal_I2C | 센서 제어, 통신 |
| **Android** | Java | MPAndroidChart, Bluetooth API | UI, 데이터 시각화 |
| **Server** | Python 3.9+ | NumPy, SciPy | 신호 처리, 인증 |

---

## 2️⃣ Motivation (동기): 왜 이 시스템이 필요한가?

### 2.1 생체 인증 기술의 발전과 한계

#### 기존 생체 인증 방식 분석

| 인증 방식 | 보급률 | 장점 | 단점 | 보안 취약점 |
|----------|--------|------|------|-------------|
| **지문** | 높음 | 빠름, 저렴 | 손상 시 인식 불가 | 실리콘 복제, 고해상도 사진 |
| **얼굴** | 높음 | 비접촉, 편리 | 조명/각도 영향 | 사진, 3D 마스크, 딥페이크 |
| **홍채** | 낮음 | 높은 정확도 | 고가 장비 필요 | 고해상도 홍채 사진 |
| **음성** | 중간 | 비접촉, 원격 가능 | 환경 노이즈 | 녹음 재생, 음성 합성 |
| **정맥** | 낮음 | 위조 어려움 | 전용 장비 필요 | 적외선 이미지 위조 |

#### 기존 인증의 공통 문제점
1. **정적 생체 정보**: 한 번 유출되면 영구적 위험
2. **생체 여부 미확인**: 살아있는 사람인지 확인 불가
3. **복제 가능성**: 고급 기술로 복제 가능

### 2.2 ECG 인증의 차별점

#### ECG가 가진 고유한 장점

```
┌─────────────────────────────────────────────────────────────────┐
│                    ECG 인증의 핵심 장점                          │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  1️⃣ 생체 여부 자동 확인 (Liveness Detection)                    │
│     ┌──────────────────────────────────────────┐               │
│     │ 심장이 뛰어야만 ECG 신호가 발생           │               │
│     │ → 사망자, 마네킹, 사진으로 위조 불가      │               │
│     │ → 별도의 생체 감지 모듈 불필요            │               │
│     └──────────────────────────────────────────┘               │
│                                                                 │
│  2️⃣ 실시간 동적 신호 (Dynamic Biometric)                        │
│     ┌──────────────────────────────────────────┐               │
│     │ 매 심박마다 새로운 신호 생성              │               │
│     │ → 녹화/재생 공격 어려움                   │               │
│     │ → 시간에 따른 변화 감지 가능              │               │
│     └──────────────────────────────────────────┘               │
│                                                                 │
│  3️⃣ 개인 고유성 (Uniqueness)                                    │
│     ┌──────────────────────────────────────────┐               │
│     │ 심장의 물리적 구조가 개인마다 다름        │               │
│     │ → P-QRS-T 파형의 형태와 타이밍이 고유     │               │
│     │ → 쌍둥이도 ECG 패턴이 다름                │               │
│     └──────────────────────────────────────────┘               │
│                                                                 │
│  4️⃣ 지속 인증 가능성 (Continuous Authentication)                │
│     ┌──────────────────────────────────────────┐               │
│     │ 웨어러블 기기로 연속 모니터링 가능        │               │
│     │ → 스마트워치, 피트니스 밴드 확장          │               │
│     │ → 사용 중 지속적 본인 확인                │               │
│     └──────────────────────────────────────────┘               │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 2.3 ECG 파형의 과학적 배경

#### 심장의 전기적 활동

```
심장 전도 시스템:

     ┌─────────────────────────────────────┐
     │           동방결절 (SA Node)         │ ← 심장의 자연 박동기
     │                 │                   │    (60-100 BPM)
     │                 ▼                   │
     │           심방 수축 → P파            │
     │                 │                   │
     │           방실결절 (AV Node)         │ ← 0.1초 지연
     │                 │                   │
     │           히스속 → 좌우 각           │
     │                 │                   │
     │           심실 수축 → QRS 복합체     │
     │                 │                   │
     │           심실 재분극 → T파          │
     │                                     │
     └─────────────────────────────────────┘
```

#### ECG 파형 구조

```
         R
         ▲
        /│\
       / │ \
      /  │  \       T
  P  /   │   \     ∧
 ∧  /    │    \   / \
/ \Q─────┘─────S─/   \──
   │    │     │
   │◀──▶│◀───▶│
   PR    QRS   ST
  간격   간격  분절

각 파형의 의미:
- P파: 심방 탈분극 (심방 수축)
- QRS: 심실 탈분극 (심실 수축)
- T파: 심실 재분극 (심실 이완)
- PR 간격: 방실 전도 시간
- QT 간격: 전체 심실 활동 시간
```

#### 개인 고유성의 원인

| 특성 | 개인차 원인 | ECG에서의 반영 |
|------|-------------|----------------|
| 심장 크기 | 체격, 성별, 나이 | R파 진폭 |
| 심장 위치 | 흉곽 형태 | 전극 리드 패턴 |
| 전도 속도 | 심장 조직 특성 | PR, QRS 간격 |
| 자율신경계 | 개인 생리 상태 | HRV 패턴 |

### 2.4 적용 시나리오

#### 2차 인증 시스템으로서의 활용

```
┌─────────────────────────────────────────────────────────────────┐
│                     2차 인증 시나리오                            │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  🏦 금융 서비스                                                  │
│     ├── 고액 이체 시 ECG 인증                                   │
│     ├── 계좌 개설 본인 확인                                     │
│     └── 금융 앱 로그인                                          │
│                                                                 │
│  🏥 의료 분야                                                    │
│     ├── 환자 본인 확인 (의료 기록 접근)                          │
│     ├── 처방전 발급 인증                                        │
│     └── 원격 의료 본인 확인                                     │
│                                                                 │
│  🔐 보안 시설                                                    │
│     ├── 데이터센터 출입                                         │
│     ├── 연구소 보안 구역                                        │
│     └── 군사 시설 접근                                          │
│                                                                 │
│  💻 디지털 서비스                                                │
│     ├── 전자 서명, 계약                                         │
│     ├── 암호화폐 지갑                                           │
│     └── 기업 시스템 접근                                        │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 3️⃣ Problem / Challenge (문제/과제)

### 3.1 프로젝트 정의 시 예상한 문제점

#### 기술적 도전 과제

| 문제 영역 | 구체적 문제 | 예상 난이도 | 해결 방향 |
|----------|------------|------------|----------|
| **신호 품질** | ECG 신호의 노이즈 | 상 | 디지털 필터링 |
| **신호 변동성** | 같은 사람도 매번 다른 신호 | 상 | 정규화 + 다중 특징 |
| **실시간 처리** | 500Hz 데이터 스트리밍 | 중 | 버퍼링 + 비동기 |
| **인증 정확도** | FAR/FRR 균형 | 상 | 하이브리드 알고리즘 |
| **하드웨어 연동** | 센서-블루투스-앱 통합 | 중 | 단계별 테스트 |

#### 노이즈 종류와 대책

```
ECG 신호에 영향을 주는 노이즈:

1️⃣ 베이스라인 원더링 (Baseline Wander)
   - 원인: 호흡, 신체 움직임
   - 주파수: 0.5Hz 이하
   - 해결: 고역 통과 필터 (0.5Hz)

2️⃣ 전원 노이즈 (Powerline Interference)
   - 원인: 60Hz 전원선 간섭
   - 주파수: 60Hz (한국)
   - 해결: 노치 필터 (60Hz, Q=30)

3️⃣ 근전도 노이즈 (EMG Noise)
   - 원인: 근육 움직임
   - 주파수: 25-100Hz
   - 해결: 저역 통과 필터 (45Hz)

4️⃣ 전극 접촉 노이즈
   - 원인: 전극 접촉 불량
   - 특성: 불규칙 스파이크
   - 해결: 전극 상태 확인, 재부착
```

### 3.2 프로젝트 진행 중 겪은 실제 어려움

---

#### 🔴 트러블슈팅 #1: 블루투스 연결 성공, 데이터 전송 실패

**발생 일시**: 프로젝트 초기

**증상 상세**:
```
[Android Logcat]
페어링된 장치: 이름=HC-06, 주소=XX:XX:XX:XX:XX:XX
타겟 장치 발견: HC-06
블루투스 소켓 연결 성공 ✅
블루투스 데이터 수신 스레드 시작됨
⚠️ 블루투스 연결됨, 하지만 데이터 수신 없음
```

**원인 분석**:
```
┌─────────────────────────────────────────────────────────────┐
│                    HC-06 모듈 구조                           │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────────┐    ┌─────────────────┐                │
│  │ 블루투스 RF 칩   │ ←→ │   UART 인터페이스 │                │
│  │  (CC2540 등)    │    │   (TX/RX 핀)     │                │
│  └────────┬────────┘    └────────┬────────┘                │
│           │                      │                         │
│     휴대폰과 통신              Arduino와 통신               │
│     (이 부분 정상)            (이 부분 문제!)               │
│                                                             │
│  💡 두 부분은 독립적으로 작동/고장                           │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

**근본 원인**: SoftwareSerial의 TX/RX 핀 개념 혼동

```cpp
// Arduino 코드
SoftwareSerial bluetooth(10, 11);  // RX=10, TX=11

// 올바른 연결:
// HC-06 TX → Arduino 10번 (SoftwareSerial의 RX)
// HC-06 RX → Arduino 11번 (SoftwareSerial의 TX)

// 잘못된 연결 (흔한 실수):
// HC-06 TX → Arduino 11번 ❌
// HC-06 RX → Arduino 10번 ❌
```

**해결 과정**:
1. 핀 연결 확인 및 교차 연결
2. 테스트 코드로 전송 확인:
   ```cpp
   void loop() {
     bluetooth.println("HELLO");
     Serial.println("Sent HELLO");
     delay(1000);
   }
   ```
3. 휴대폰 블루투스 터미널 앱에서 "HELLO" 수신 확인

**교훈**:
> "연결(Connection)과 통신(Communication)은 다르다"
> 물리적 연결이 되어도 데이터가 흐르지 않을 수 있다

---

#### 🔴 트러블슈팅 #2: HC-06 모듈 하드웨어 고장

**발생 일시**: 트러블슈팅 #1 해결 시도 중

**증상 상세**:
- TX/RX 핀을 올바르게 교차 연결해도 데이터 전송 안됨
- Arduino 시리얼 모니터에서는 데이터 정상 출력
- 블루투스 연결은 계속 성공

**하드웨어 고장 진단 프로세스**:

```
Step 1: 소프트웨어 검증
├── Arduino 코드 검토 → 정상
├── 시리얼 모니터 출력 확인 → 정상
└── 결론: 소프트웨어 문제 아님

Step 2: 연결 검증
├── TX/RX 교차 연결 확인 → 정상
├── VCC/GND 전압 확인 → 5V 정상
└── 결론: 연결 문제 아님

Step 3: 모듈 기능 검증
├── 블루투스 연결 테스트 → 성공 (RF 칩 정상)
├── 데이터 전송 테스트 → 실패 (UART 문제)
└── 결론: UART TX 핀 고장 의심

Step 4: 모듈 교체
├── 새 HC-06 모듈로 교체
└── 결과: 정상 작동!
```

**고장 원인 추정**:
- 정전기 손상 (ESD)
- 과전압 인가
- 납땜 불량

**예방 대책**:
1. 모듈 취급 시 정전기 방지
2. 연결 전 전압 확인
3. 예비 모듈 확보

---

#### 🔴 트러블슈팅 #3: 타인 ECG로도 인증 성공 (심각한 보안 문제)

**발생 일시**: 인증 시스템 테스트 중

**증상 상세**:
```
테스트 시나리오:
1. 사용자 A의 ECG로 등록 완료
2. 사용자 B의 ECG로 로그인 시도
3. 예상: 인증 실패 ❌
4. 실제: 인증 성공 ✅ (유사도 87%)

→ 보안 취약점! 다른 사람도 로그인 가능
```

**원인 분석**:

```python
# 문제 1: 너무 관대한 거리 스케일
distance = np.linalg.norm(v1 - v2)
scale = 15.0  # ← 너무 큼! 거리를 과소평가
euclidean_sim = 1.0 / (1.0 + distance / scale)

# 문제 2: Z-score 정규화가 개인 특성 제거
v1_normalized = (v1 - np.mean(v1)) / np.std(v1)
v2_normalized = (v2 - np.mean(v2)) / np.std(v2)
# → 모든 벡터가 평균=0, 표준편차=1로 변환
# → 개인 간 절대값 차이가 사라짐!

# 예시:
# 사용자 A: [100, 200, 300] → 정규화 후 [-1.22, 0, 1.22]
# 사용자 B: [50, 100, 150]  → 정규화 후 [-1.22, 0, 1.22]
# → 정규화 후 동일! 구분 불가!
```

**해결책 - 엄격한 하이브리드 유사도**:

```python
def _euclidean_similarity(self, v1, v2):
    """엄격한 하이브리드 유사도 계산"""
    
    # 1. 원본 값 차이 (개인 특성 보존) - 30%
    abs_diff = np.abs(v1 - v2)
    mean_abs_diff = np.mean(abs_diff)
    value_range = max(np.max(np.abs(v1)), np.max(np.abs(v2)))
    relative_diff = mean_abs_diff / value_range
    raw_similarity = max(0, 1.0 - relative_diff * 2.0)
    
    # 2. 코사인 유사도 (패턴 형태) - 25%
    # Z-score 정규화 후 계산
    cosine_sim = np.dot(v1_norm, v2_norm) / (norm1 * norm2)
    
    # 3. 유클리드 거리 (엄격하게!) - 20%
    scale = 5.0  # 15.0 → 5.0으로 엄격화
    euclidean_sim = 1.0 / (1.0 + distance / scale)
    
    # 4. 핵심 특징 비교 (형태학적 특징) - 25%
    core_features = v1[:10]  # 처음 10개 = 형태학적 특징
    core_similarity = ...
    
    # 최종 하이브리드
    return 0.30 * raw_similarity + \
           0.25 * cosine_sim + \
           0.20 * euclidean_sim + \
           0.25 * core_similarity
```

**개선 전후 비교**:

| 테스트 케이스 | 개선 전 유사도 | 개선 후 유사도 | 결과 |
|--------------|---------------|---------------|------|
| 본인 vs 본인 | 92% | 91% | 성공 ✅ |
| 본인 vs 타인 A | 87% | 72% | 실패 ✅ |
| 본인 vs 타인 B | 85% | 68% | 실패 ✅ |
| 본인 vs 타인 C | 83% | 65% | 실패 ✅ |

---

#### 🔴 트러블슈팅 #4: 파이프라인 실패 시 불완전한 데이터 등록

**증상**:
```json
// R-peak 검출 실패해도 이런 응답이 옴
{
    "status": "success",  // ← 문제!
    "message": "등록 완료",
    "feature_vector": [0.5, 0.3, 0.8, ...]  // 단순 통계값만
}
```

**문제점**:
- 형태학적 특징(P, Q, R, S, T 파) 없이 등록됨
- 평균, 분산 등 일반적인 통계값만 저장
- 이후 로그인 시 정확도 심각하게 저하

**원인 - 잘못된 폴백 처리**:
```python
# 기존 코드
def process(self, ecg_data):
    try:
        result = self.pipeline.process(ecg_data)
        return result
    except Exception as e:
        # 문제: 실패해도 성공으로 처리!
        return self._process_basic(ecg_data)  # 기본 처리로 폴백
```

**해결책 - 명확한 에러 반환**:
```python
# 수정된 코드
def process(self, ecg_data):
    try:
        result = self.pipeline.process(ecg_data)
        return result
    except Exception as e:
        # 명확한 에러 반환
        return {
            "status": "error",
            "message": f"파이프라인 처리 실패: {e}",
            "sample_count": len(ecg_data)
        }
```

**교훈**:
> "불완전한 성공보다 명확한 실패가 낫다"
> 사용자에게 재측정을 안내하는 것이 더 좋은 UX

---

#### 🔴 트러블슈팅 #5: R-peak 검출 부족

**증상**:
```json
{
    "status": "insufficient_peaks",
    "message": "R-peak가 부족합니다. 검출: 2개, 필요: 3개 이상"
}
```

**원인 분석**:

```
원인 1: 신호 품질 문제
├── 전극 접촉 불량
├── 피부 저항 높음 (건조한 피부)
└── 전극 젤 부족

원인 2: 측정 시간 부족
├── 6초 = 3000 샘플 (500Hz 기준)
├── 심박수 50 BPM = 5초에 4.17비트
├── 서맥 환자의 경우 R-peak 부족 가능
└── 해결: 측정 시간 연장 (6초 → 10초)

원인 3: Pan-Tompkins 임계값 문제
├── 고정 임계값 사용 시 개인차 반영 못함
├── 적응형 임계값으로 개선
└── 로컬 최대값 검색 추가
```

**해결책**:
1. 전극 상태 확인 및 재부착
2. 측정 시간 연장 옵션 제공
3. 적응형 임계값 알고리즘 적용
4. 품질 점수 기반 재측정 안내

---

#### 🔴 트러블슈팅 #6: 9600 baud 대역폭 한계

**문제**:
```
필요 대역폭 계산:
- 500Hz 샘플링
- 각 샘플: 3-4자리 숫자 + 줄바꿈 = ~6바이트
- 필요: 500 × 6 = 3000바이트/초

9600 baud 실제 처리량:
- 9600bps ÷ 10비트 = 960바이트/초
- 부족! 데이터 손실 발생

해결:
- HC-06 보드레이트 변경: AT+BAUD7 (57600)
- 또는 샘플링 레이트 감소: 500Hz → 250Hz
```

---

#### 🔴 트러블슈팅 #7: LCD 라이브러리 설치 오류

**증상**:
```
fatal error: LiquidCrystal_I2C.h: No such file or directory
compilation terminated.
```

**해결**:
1. Arduino IDE → 스케치 → 라이브러리 포함 → 라이브러리 관리
2. "LiquidCrystal I2C" 검색
3. 설치 또는 ZIP 파일 수동 설치
4. Arduino IDE 재시작

---

#### 🔴 트러블슈팅 #8: PyCharm Python 인터프리터 미설정

**증상**:
```
"Configuration is still incorrect. Do you want to edit it again?"
```

**해결**:
1. Settings → Python Interpreter → Add
2. System Interpreter 선택 (`/usr/bin/python3`)
3. 또는 터미널에서 직접 실행: `python3 ecg_server.py`

---

## 4️⃣ Solution (해결책) 종합

### 4.1 하드웨어 문제 해결 요약

| 문제 | 증상 | 해결책 | 예방법 |
|------|------|--------|--------|
| TX/RX 핀 오류 | 연결 OK, 데이터 X | 교차 연결 확인 | 회로도 문서화 |
| 모듈 고장 | 테스트 코드 실패 | 모듈 교체 | 예비 부품 확보 |
| 대역폭 부족 | 데이터 손실 | 57600 baud | 사전 계산 |
| LCD 오류 | 라이브러리 없음 | ZIP 설치 | 의존성 목록화 |

### 4.2 소프트웨어 문제 해결 요약

| 문제 | 증상 | 해결책 | 예방법 |
|------|------|--------|--------|
| 인증 정확도 | 타인 인증 성공 | 하이브리드 알고리즘 | 다중 테스트 |
| 폴백 처리 | 불완전 등록 | 명확한 에러 반환 | 예외 처리 검토 |
| R-peak 부족 | 검출 실패 | 시간 연장 + 적응형 | 품질 검증 |

### 4.3 최종 유사도 알고리즘 상세

```python
def calculate_hybrid_similarity(v1, v2):
    """
    엄격한 하이브리드 유사도 계산
    
    구성:
    - 원본 값 차이: 30% (개인 특성 보존)
    - 코사인 유사도: 25% (패턴 형태)
    - 유클리드 유사도: 20% (거리 기반)
    - 핵심 특징 유사도: 25% (형태학적)
    
    임계값: 85% 이상이면 인증 성공
    """
    
    # 1. 원본 값 차이 (30%)
    raw_similarity = calculate_raw_difference(v1, v2)
    
    # 2. 코사인 유사도 (25%)
    cosine_sim = calculate_cosine_similarity(v1, v2)
    
    # 3. 유클리드 유사도 (20%)
    euclidean_sim = calculate_euclidean_similarity(v1, v2, scale=5.0)
    
    # 4. 핵심 특징 유사도 (25%)
    core_sim = calculate_core_feature_similarity(v1[:10], v2[:10])
    
    # 하이브리드 조합
    hybrid = 0.30 * raw_similarity + \
             0.25 * cosine_sim + \
             0.20 * euclidean_sim + \
             0.25 * core_sim
    
    return max(0, min(1, hybrid))
```

---

## 5️⃣ Lessons Learned (배운 점)

### 5.1 기술적 배운 점

#### 신호 처리 분야

| 배운 점 | 상세 내용 |
|---------|----------|
| **Butterworth 필터** | 최대 평탄 특성으로 ECG 파형 왜곡 최소화 |
| **Pan-Tompkins** | 40년 된 알고리즘이지만 여전히 표준으로 사용됨 |
| **FFT 분석** | 시간 영역 → 주파수 영역 변환으로 숨은 특징 발견 |
| **정규화 주의** | Z-score만 사용하면 개인 특성이 사라질 수 있음 |

#### 하드웨어/통신 분야

| 배운 점 | 상세 내용 |
|---------|----------|
| **TX/RX 교차** | 시리얼 통신에서 송신과 수신은 교차 연결 |
| **모듈 독립성** | 블루투스 RF와 UART는 독립적으로 고장 가능 |
| **대역폭 계산** | 샘플링 레이트 × 데이터 크기 ≤ 전송 속도 |

#### 인증 시스템 분야

| 배운 점 | 상세 내용 |
|---------|----------|
| **FAR/FRR 균형** | 임계값 조정으로 보안성과 편의성 밸런스 |
| **다중 특징** | 단일 특징보다 여러 특징 조합이 정확도 향상 |
| **하이브리드 접근** | 코사인 + 유클리드 조합이 각각보다 우수 |

### 5.2 프로젝트 관리 배운 점

#### 디버깅 방법론

```
효과적인 디버깅 순서:

1️⃣ 단계별 검증 (Divide and Conquer)
   ├── Arduino 단독 테스트 (시리얼 모니터)
   ├── Bluetooth 단독 테스트 (테스트 코드)
   ├── Android 앱 단독 테스트 (더미 데이터)
   └── 서버 단독 테스트 (테스트 클라이언트)

2️⃣ 로그 기반 추적
   ├── 각 단계에 로그 출력 추가
   ├── 데이터 흐름 시각화
   └── 병목 지점 식별

3️⃣ 최소 재현 사례 (Minimal Reproducible Example)
   ├── 문제를 가장 단순한 형태로 재현
   ├── 불필요한 요소 제거
   └── 원인 격리
```

#### 문서화의 중요성

1. **트러블슈팅 기록**: 같은 문제 재발 시 빠른 해결
2. **회로도 문서화**: 핀 연결 혼란 방지
3. **의존성 목록**: 환경 재구성 용이

### 5.3 핵심 교훈 요약

```
📌 "연결 성공 ≠ 통신 성공"
   → 물리적 연결과 데이터 흐름은 별개

📌 "불완전한 성공 < 명확한 실패"
   → 에러 상황에서는 명확히 실패 처리

📌 "정규화는 양날의 검"
   → 잘못 사용하면 중요한 특성이 사라짐

📌 "단일 지표보다 다중 지표"
   → 여러 측정 방법을 조합하면 정확도 향상
```

---

## 6️⃣ Role per Member (팀원별 역할)

### 6.1 역할별 담당 내용

| 역할 | 담당 내용 | 비중 | 주요 산출물 |
|------|----------|------|------------|
| **하드웨어** | 회로 설계, 센서 연결, LCD 추가 | 20% | 회로도, Arduino 코드 |
| **Android** | UI 개발, Bluetooth/TCP 통신 | 25% | APK, MainActivity.java |
| **Server** | 파이프라인, 인증 로직 | 35% | ecg_server.py, 모듈들 |
| **알고리즘** | 유사도 개선, 특징 추출 | 10% | auth_manager.py 수정 |
| **문서화** | 보고서, 트러블슈팅 가이드 | 10% | MD 문서들 |

### 6.2 구현 모듈 상세

```
📁 ECG-SIGN-Digital-Signature-System/
│
├── 📁 Hardware/
│   └── 📁 Arduino_Code/
│       └── main.ino                  # ECG 센서 + Bluetooth + LCD
│
├── 📁 Software/
│   ├── 📁 Android_App/
│   │   └── 📁 app/src/main/
│   │       ├── java/.../MainActivity.java  # 메인 로직
│   │       └── res/layout/activity_main.xml  # UI
│   │
│   └── 📁 Signal_Processing/
│       ├── ecg_server.py             # TCP 서버
│       ├── requirements.txt          # 의존성
│       ├── 📁 user_data/
│       │   └── users.json            # 사용자 데이터
│       └── 📁 ecg_processor/
│           ├── __init__.py
│           ├── preprocessing.py      # 전처리 (필터링)
│           ├── r_peak_detector.py    # R-peak (Pan-Tompkins)
│           ├── beat_processor.py     # 비트 처리
│           ├── feature_extractor.py  # 특징 추출 (37개+)
│           ├── signature_generator.py # 서명 생성 (SHA-256)
│           ├── pipeline.py           # 통합 파이프라인
│           └── auth_manager.py       # 인증 관리 (개선됨)
│
└── 📁 Docs/
    ├── PROJECT_REPORT_FINAL.md       # 최종 보고서 (이 문서)
    ├── PPT_SLIDES_CONTENT.md         # PPT 슬라이드 내용
    └── TROUBLESHOOTING.md            # 트러블슈팅 가이드
```

---

## 📊 최종 성과 및 성능 지표

### 시스템 사양

| 항목 | 사양 | 비고 |
|------|------|------|
| **샘플링 레이트** | 500 Hz | 2ms 간격 |
| **ADC 해상도** | 10비트 | 0-1023 범위 |
| **수집 시간** | 6초 | 3000 샘플 |
| **처리 시간** | < 1초 | 파이프라인 전체 |
| **특징 수** | 37개+ | 4개 도메인 |
| **인증 임계값** | 85% | 하이브리드 유사도 |
| **서명 길이** | 64자 | SHA-256 해시 |

### 예상 성능 (추정)

| 지표 | 값 | 의미 |
|------|-----|------|
| **FAR** | < 5% | 타인 오인식률 |
| **FRR** | < 10% | 본인 오거부율 |
| **인증 시간** | < 7초 | 측정 + 처리 |

---

## 🔮 향후 개선 계획

### 단기 계획 (1-3개월)
- [ ] 실제 사용자 테스트 및 정확도 검증
- [ ] 다중 템플릿 등록 (다양한 조건에서)
- [ ] UI/UX 개선

### 중기 계획 (3-6개월)
- [ ] 데이터베이스 연동 (SQLite/PostgreSQL)
- [ ] 웹 대시보드 개발
- [ ] 실시간 ECG 모니터링

### 장기 계획 (6개월+)
- [ ] 웨어러블 기기 연동 (스마트워치)
- [ ] 딥러닝 기반 특징 추출
- [ ] 클라우드 서비스화

---

## 🔑 핵심 메시지

> "ECG 파형에서 **Pan-Tompkins 알고리즘**으로 심박을 찾고, **30개 이상의 형태학적·시간·주파수·통계 특징**을 추출해 **SHA-256 해시**로 변환한 뒤, **엄격한 하이브리드 유사도 알고리즘**으로 본인 여부를 판단하는 **위조 불가능한 2차 인증 시스템**"

---

## 📚 참고 문헌

1. Pan, J., & Tompkins, W. J. (1985). "A Real-Time QRS Detection Algorithm". IEEE Transactions on Biomedical Engineering.
2. Odinaka, I., et al. (2012). "ECG Biometric Recognition: A Comparative Analysis". IEEE Access.
3. Biel, L., et al. (2001). "ECG analysis: A new approach in human identification". IEEE Transactions on Instrumentation and Measurement.
4. Israel, S. A., et al. (2005). "ECG to identify individuals". Pattern Recognition.

---

*작성일: 2025-12-13*
*최종 수정: 2025-12-13*
*버전: 2.0*
